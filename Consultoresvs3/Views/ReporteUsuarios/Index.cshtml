@model IEnumerable<Consultoresvs3.Models.ReporteUsuario>

@{
    ViewBag.Title = "Reporte Usuarios";
}

<h2 style="font-weight:bold;">Reporte Usuarios</h2>

@if (User.IsInRole("ADMIN"))
{
}
else
{<p>
    @Html.ActionLink("Agregar Reporte", "Create")
</p> }

<!--menu filtros de busqueda-->
@if (User.IsInRole("ADMIN"))
{
    <div class="row">
        <div class="col-md-3">
            <h3>Filtrar por</h3>
        </div>
        <div class="col-md-3">
            <select id="filtrosAdm">
                <option value="1">Empleado</option>
                <option value="2">Empresa</option>
                <option value="3">Fecha</option>
                <option value="4">Proyecto</option>
            </select>
        </div>
        <div class="col-md-2">
            <a class="btn btn-primary" onclick="FiltrosAdmin()">Buscar</a>
        </div>
    </div>
}
else
{
    <div class="row">
        <div class="col-md-3">
            <h3>Filtrar por</h3>
        </div>
        <div class="col-md-3">
            <select id="filtrosEmp">
                <option value="1">Fecha</option>
                <option value="2">Proyecto</option>
            </select>
        </div>
        <div class="col-md-2">
            <a class="btn btn-primary" onclick="FiltrosEmp()">Buscar</a>
        </div>
    </div>
}

<br />
<form id="f" style='display:none'>
    <div class="row">
        <!--Filtro Proyecto--> 
        <label class="control-label col-md-2" for="ProyectosUsuario">Proyectos</label>
        <div class="col-md-2">
            @Html.DropDownList("idProyecto", null, htmlAttributes: new { @class = "form-control" })
        </div>
    </div>   
    @if (User.IsInRole("ADMIN"))
    {
        <div class="form-group">
            <a class="btn btn-primary proyect" data-url="@Url.Content("/ReporteUsuarios/FiltroProyectoAdm/")">Consultar Proyecto Admin</a>
        </div>

    }
    else
    {
        <div class="form-group">
            <a class="btn btn-primary proyect" data-url="@Url.Content("/ReporteUsuarios/FiltroProyectoEmp/")">Consultar Proyecto Empleado</a>
        </div>
    }
</form>
@if (User.IsInRole("ADMIN"))
{
    <form id="emp" style='display:none'>
        <div class="form-group">
            <label class="control-label col-md-2" for="ProyectosUsuario">Empresas</label>
            <div class="col-md-10">
                @Html.DropDownList("idEmpresa", null, htmlAttributes: new { @class = "form-control" })
            </div>
            <a class="btn btn-primary empB" data-url="@Url.Content("/ReporteUsuarios/FiltroEmpresaAdm/")">Consultar Empresa Admin</a>
        </div>
    </form>
}

    <div class="row" id="date" style='display:none'>
        <!--filtro para la fecha-->
        <label class="control-label col-md-2">Fecha</label>
        <form id="date">
            <div class="col-md-4">
                <select id="mes" name="Mes">
                    <option value="1">01-ENERO</option>
                    <option value="2">02-FEBRERO</option>
                    <option value="3">03-MARZO</option>
                    <option value="4">04-ABRIL</option>
                    <option value="5">05-MAYO</option>
                    <option value="6">06-JUNIO</option>
                    <option value="7">07-JULIO</option>
                    <option value="8">08-AGOSTO</option>
                    <option value="9">09-SEPTIEMBRE</option>
                    <option value="10">10-OCTUBRE</option>
                    <option value="11">11-NOVIEMBRE</option>
                    <option value="12">12-DICIEMBRE</option>
                </select>
                <!-- <input type="text" id="mes"/>-->
                <!--<input type="text" id="año" />-->
                <select id="año" ></select><br /> 
            </div>
            @if (User.IsInRole("ADMIN"))
            {
                <div class="col-md-2" id="fechaAdm">
                    <a class="btn btn-primary fecha" data-url="@Url.Content("/ReporteUsuarios/FiltroReporteUFechaAdm/")">Buscar</a>
                </div>
            }
            else
            {
                <div class="col-md-2">
                    <a class="btn btn-primary fecha" data-url="@Url.Content("/ReporteUsuarios/FiltroReporteUFechaEmp/")">Buscar</a>
                </div>
            }
        </form>
       
    </div> 

    <br />
    
    <!--Filtro Empleado--> 
    @if (User.IsInRole("ADMIN"))
    {
        <form id="form-employes" style='display:none'>
            <div class="row">
                <label class="control-label col-md-2" for="ProyectosUsuario">Empleados</label>
                <div class="col-md-2">
                    @Html.DropDownList("UsuarioId", null, htmlAttributes: new { @class = "form-control" })
                </div>

                <div class="col-md-2">
                    <a class="btn btn-primary Bemployes" data-url="@Url.Content("/ReporteUsuarios/FiltroEmpleadoAdm/")">Buscar</a>
                </div>
            </div>
        </form>
    }

<br /><br />



<!--TABLA DONDE SE GENERAN LOS REPORTES-->
<table class="table" id="filtro">
    <tr>
        <th>
            Proyecto
        </th>
        @if (User.IsInRole("ADMIN"))
        {
            <th>
                Usuario
            </th>
        }
        <th>
            @Html.DisplayNameFor(model => model.Servicio.Nombre)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.FechaReporte)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.HTrabajadas)
        </th>
        <th></th>
    </tr>

@foreach (var item in Model) {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.Proyecto.Nombre)
        </td>
        @if (User.IsInRole("ADMIN"))
        {
            <td>
                @Html.DisplayFor(modelItem => item.Usuario.Nombre)
            </td>
        }
        <td>
            @Html.DisplayFor(modelItem => item.Servicio.Nombre)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.FechaReporte)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.HTrabajadas)
        </td>
        <td>
            @Html.ActionLink("Eliminar", "Delete", new { id=item.Id })
        </td>
    </tr>
}
</table>

@Html.ActionLink("Export Excel: ", "ExportExcel")
@section scripts {
    <script>
           $(document).ready(function () {
                    $('.proyect').click(function () {
                        $.ajax({
                            method: 'POST',
                            url: $(this).data('url'),
                            data: $('#f').serialize()
                        })
                            .done(function (data) {
                                $('#filtro').hide();
                                $('#filtro').html(data);
                                $('#filtro').show('fast');
                            }).fail(function () {
                                alert("error");
                         });
            });
               //filtro por fecha
                    $('.fecha').click(function () {
                        var mes = $('#mes').val();
                        var año = $('#año').val();
                        $.ajax({
                            method: 'POST',
                            url: $(this).data('url'),
                            data: { mes: mes, año: año }
                        })
                            .done(function (data) {
                                $('#filtro').hide();
                                $('#filtro').html(data);
                                $('#filtro').show('fast');
                            }).fail(function () {
                                alert("error");
                            });
                    });

               //filtro por empresa
                    $('.empB').click(function () {
                        $.ajax({
                            method: 'POST',
                            url: $(this).data('url'),
                            data: $('#emp').serialize()
                        })
                            .done(function (data) {
                                $('#filtro').hide();
                                $('#filtro').html(data);
                                $('#filtro').show('fast');
                            }).fail(function () {
                                alert("error");
                            });
                    });


                    //filtro por empresa
                    $('.Bemployes').click(function () {
                        $.ajax({
                            method: 'POST',
                            url: $(this).data('url'),
                            data: $('#form-employes').serialize()
                        })
                            .done(function (data) {
                                $('#filtro').hide();
                                $('#filtro').html(data);
                                $('#filtro').show('fast');
                            }).fail(function () {
                                alert("error");
                            });
                    });
            });
    </script>

    <script>
        function listyears() {
            var anios = document.getElementById("año");
            var fecha = new Date();
            year = fecha.getFullYear();
            var listyear = [];
            for (var i = 2000; i <= year; ++i) {
                listyear.unshift(i);
            }
            for (var j = 0; j < listyear.length; ++j) {
                anios.options[j] = new Option(listyear[j], listyear[j]);
            }
        }
    </script>

    <script>
        function FiltrosAdmin() {
            var indice = document.getElementById("filtrosAdm").value;
            var empleado = document.getElementById("form-employes");
            var empresa = document.getElementById("emp");
            var fecha = document.getElementById("date");
            var proyecto = document.getElementById("f");
            if (indice == 1) {
                empleado.style.display = 'block';
                empresa.style.display = 'none';
                fecha.style.display = 'none';
                proyecto.style.display = 'none';
            }
            if (indice == 2) {
                empresa.style.display = 'block';
                empleado.style.display = 'none';
                fecha.style.display = 'none';
                proyecto.style.display = 'none';
            }
            if (indice == 3) {
                listyears();
                fecha.style.display = 'block';
                empleado.style.display = 'none';
                empresa.style.display = 'none';
                proyecto.style.display = 'none';
            }
            if (indice == 4) {
                proyecto.style.display = 'block';
                empleado.style.display = 'none';
                empresa.style.display = 'none';
                fecha.style.display = 'none';
            }
        }
        </script>

    <script>
        function FiltrosEmp() {
            var indice = document.getElementById("filtrosEmp").value;
            var fecha = document.getElementById("date");
            var proyecto = document.getElementById("f");
            if (indice == 1) {
                listyears();
                fecha.style.display = 'block';
                proyecto.style.display = 'none';
            }
            if (indice == 2) {
                proyecto.style.display = 'block';
                fecha.style.display = 'none';
            }
        }
    </script>
            




}